!function(e,n){"function"==typeof define&&define.amd?define("waterpipe",[],n):"object"==typeof module&&module.exports?module.exports=n():e.waterpipe=n()}(this,function(){"use strict";var t,u,l,h,v=1,b=2,m=3,x=4,M=5,C=6,k=7,p=1,N=2,E=3,j=4,P=5,_=6,D=7,T=8,w="if",S="if not",A="else",O="elseif",$="elseif not",L="foreach",F="\r\n",W="area base br col command embed hr img input keygen link meta param source track wbr !doctype !--".split(" "),q={true:!0,false:!1,undefined:void 0,null:null,0:0},g=/./.constructor,z=0,U=[],J="undefined"!=typeof Intl&&Intl.Collator&&new Intl.Collator(void 0,{caseFirst:"upper"}),H=Object.create?Object.create(null):{},r={},a=[function(e,n){return c(e,n,1)},function(e,n){return c(e,n,1,1)},function(e,n){return c(e,n,-1)},function(e,n){return c(e,n,-1,1)}];function I(e,n){var t=e.cache=e.cache||{};return t.hasOwnProperty(n)?t[n]:t[n]=e(n)}function o(e){if(!d(e)||e instanceof Date)return e;if("number"==typeof e)return new Date(e);var n=y(e);return e=new Date(n),/\d{2}:\d{2}:\d{2}/.test(n)||e.setHours(0,0,0,0),e}function K(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n}function R(e){return"function"==typeof e}function Y(e){return"string"==typeof e}function V(e){return"object"==typeof e}function d(e){return null!=e}function Z(e){return"object"!=typeof e||null===e}function G(e,n){return!(!d(e)||R(e[n]))&&(V(e)?e.hasOwnProperty(n)||Array.isArray(e)&&/^\d+$/.test(n):void 0!==e[n])}function B(e){return e}function X(e){return function(){return e}}function Q(n){return function(e){return d(e)?e[n]:void 0}}function ee(e,t){function n(n){return de(t,function(e){return G(e,n)},!0)}switch(e.state()){case"func":return e.fn();case"auto":var r=e.raw(),a=e.eval(r);if(Y(a)&&n(a))return I(Q,a);var o=H[r];return!o||o.varargs||n(r)?I(Q,r):R(o)?o:function(e){return ke(o,e)}}return I(Q,y(e.next()))}function ne(n){try{return JSON.stringify(n)}catch(e){return String(n)}}function y(e,n){return!d(e)||e!=e||R(e)?"":Y(e)?e:(n||String)(e)}function te(e,n){return new Array((+n||0)+1).join(y(e))}function re(e,n,t){return"number"==typeof e&&(e=te(" ",e)),(t||"")+te(e,n)}function ae(e,n){return((e||"").length||0)-(+n||0)-1}function oe(e){for(var n,t=1,r=("+"!==e[0]&&"-"!==e[0]||(t="-"===e[0]?-1:1,e=e.slice(1)),[0,0,0,0,0,0,0]),a=/(\d+)([yMwdhms])/g;null!==(n=a.exec(e));)"w"===n[2]?r[2]+=7*parseInt(n[1])*t:r["yMdhms".indexOf(n[2])]+=parseInt(n[1])*t;return r}function ue(e){return"/"===e.charAt(0)&&/\/((?![*+?])(?:[^\r\n\[/\\]|\\.|\[(?:[^\r\n\]\\]|\\.)*\])+)\/((?:g(?:im?|mi?)?|i(?:gm?|mg?)?|m(?:gi?|ig?)?)?)/g.test(e)&&new g(g.$1,g.$2)}function ie(e){for(var n,t=[],r=/((?!^)\$)?([^$.()][^.]*)|\$\(([^)]+)\)/gi;null!==(n=r.exec(e));)t.push(n[1]||n[3]?I(ie,n[3]||n[2]):"^"===n[2][0]?{fn:ae,arg:n[2].slice(1)}:n[2]);switch(t.length||(t[0]=e),t[0]){case".":case"@0":t.evalMode=p;break;case"#":case"#key":t.evalMode=N;break;case"##":case"#index":t.evalMode=E;break;case"#count":t.evalMode=j;break;case"_":case"@root":t.evalMode=p,t.stackIndex=-1;break;case"@global":t.evalMode=P;break;case"@now":t.evalMode=_;break;case"@today":t.evalMode=D;break;case"@random":t.evalMode=T;break;default:/^@(\d+)$/.test(t[0])&&(t.evalMode=p,t.stackIndex=+g.$1)}return t}function se(e,n){n=n?/["'<>]|&(?!#\d+;|[a-z][a-z0-9]+;)/i:/["'&<>]/;if(!n.exec(e))return e;for(var t,r="",a=0,o=0,a=n.lastIndex;a<e.length;a++){switch(e.charCodeAt(a)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}o!==a&&(r+=e.substring(o,a)),o=a+1,r+=t}return o!==a?r+e.substring(o,a):r}function n(e){return y(e).replace(/[A-Z](?:[A-Z]+(?=$|[A-Z]))?/g,function(e,n){return(0<n?"-":"")+e.toLowerCase()})}function ce(e,n){if(e&&"length"in e){for(r=0,a=e.length;r<a;r++)if(!1===n(r,e[r]))return}else if(e&&V(e))for(var t=Object.getOwnPropertyNames(e),r=0,a=t.length;r<a;r++)if(!1===n(t[r],e[t[r]]))return}function le(){for(var e=K.apply(null,arguments),n=1,t=e.length;n<t;n++)for(var r in e[n])e[0][r]=e[n][r];return e[0]}function fe(t,r,a){if(!d(t))return t;var o=Array.isArray(t)?[]:{};return ce(t,function(e,n){r(n,e)&&(o[t.push?o.length:e]=(a||B)(n,e))}),o}function de(e,t,r,a){var o;return ce(e,function(e,n){if(a^!!t(n,e))return o=r||n,!1}),o}function he(e){var n=[];return ce(e,function(e){n.push(e)}),n}function c(e,n,t,r){if(Array.isArray(e)&&Array.isArray(n)){for(var a,o=0,u=Math.min(e.length,n.length);o<u&&!a;o++)a=c(e[o],n[o],t,r);return a||e.length-n.length}if(e===n)return 0;var i=!d(e)&&-1,s=!d(n)&&1;if(i||s)return(i+s)*t;if(Y(e)||Y(n)){if(e=y(e),n=y(n),r){if(J)return J.compare(e,n)*t;e=e.toLowerCase(),n=n.toLowerCase()}return(n<e?1:e<n?-1:0)*t}return(e-n)*t}function pe(t,e,r){var a=Array.isArray(t)?new Array(t.length):{},o=ee(e,t);if(!d(t))return t;var u=[];return ce(t,function(e,n){u.push([e,n,o(n,e)])}),u.sort(function(e,n){return r(e[2],n[2])}),ce(u,function(e,n){a[t.push?e:n[0]]=n[1]}),a}function ge(e,n,t,r,a){var o=e.substr(0,r||n).split("\n").reverse(),u=e.substring(e.lastIndexOf("\n",n)+1,n).replace(/^\s+/,"").substr(-20),e=e.substring(n,e.indexOf("\n",t)+1||e.length).replace(/\r?\n|\s+$/g,"").substr(0,t-n+20);return i('at line {{$0}} column {{$1}}:\n\t{{$2}}{{$3}}\n\t{{$2.length + $4 repeat " "}}{{$5 repeat ^}}',[o.length,o[0].length+1,u,e,r-n||0,a-r||t-n],{html:!1})}function e(t){return function(e,n){return t(y(e),y(n))}}function ye(e,n){this.value=e,this.index=n}function ve(e,n,t,r,a){var o=this;o.textValue=n,o.value=(n=n,q.hasOwnProperty(n)?q[n]:/^(NaN|-?(?:(?:\d+|\d*\.\d+)(?:[E|e][+|-]?\d+)?|Infinity))$/.test(n)?parseFloat(n):n),o.canEvaluate=o.value===o.textValue&&a,o.start=t,o.end=r,e&&(e.next=o)}function be(e,n){for(var t,r=new ye(e,n||0),a=/([^\s\\"`]|\\.)(?:[^\s\\]|\\.)*|"((?:[^"\\]|\\.)*)"|`(\S+)/gi;null!==(t=a.exec(e));)r.unshift(new ve(r[0],t[3]||(void 0!==t[2]?t[2]:t[0]),r.index+t.index,r.index+a.lastIndex,!t[3]&&void 0===t[2]&&("$"===t[1]||void 0)));return r.reverse()}function me(n){var t,e,f=[],s=[{}],d=[],r=0,a="",i=/\{\{([\/!]|foreach(?=\s|\})|if(?:\snot)?(?=\s)|else(?:if(?:\snot)?(?=\s))?|&?(?!\}))\s*((?:\}(?!\})|[^}])*\}*)\}\}/g;function c(e){if(!e)throw new Error("Unexpected "+t[0]+" "+ge(n,t.index,i.lastIndex))}function o(e){return be(e,t.index+t[0].indexOf(e))}function l(e,n){var t,c=f.length,r=/<(\/?)([0-9a-z]+|!doctype|!--)|\/?>|-->|([^\s=\/<>"0-9.-][^\s=\/<>"]*)(?:="|$|(?=[\s=\/<>"]))|"|(\s+)/gi,a=0;function l(){return d[0].opened&&("script"===d[0].tagName||"style"===d[0].tagName)||"!--"===d[0].tagName}function o(){return d.length>(s[0].htmlStackCount||1)&&d.shift()}function u(e,n,t){if(l())f.push({op:k,value:e,ovalue:e,nvalue:e});else{var r=d[0].attrName,a=d[0].opened;if(void 0===t&&(t=e),n||r||a){var o,u=f[f.length-1],i=f[f.length-2],s=e;if(n?(s=e.replace(/^\s+/,""),t=t.replace(/^\s+/,"")):(o=0<=e.indexOf("\n"),s=e=e.replace(/^\s+/g,a&&(!u||u.op!==C)||r&&d[0].text?" ":""),o&=!(e=r?e:se(e,!0))||" "===e),d[0].text+=e,o)return u&&(u.stripWSEnd=!1),void f.push({op:C,value:F,ovalue:t});if(e&&(d[1]&&a||" "!==e))return r=">"===e[e.length-1],void(f.length>c&&u.op===k?(u.value+=e,u.ovalue+=s,u.nvalue+=t,u.isTagEnd=r,u.stripWSEnd=n):f.length>c+1&&i.op===k&&u.value!==F?(o="<"===e[0]||i.isTagEnd||!n&&!i.stripWSEnd?u.value:"",i.value+=o+e,i.ovalue+=u.ovalue+s,i.nvalue+=u.ovalue+t,i.isTagEnd=r,i.stripWSEnd=n,f.pop()):f.push({op:k,stripWS:n,stripWSEnd:n,isTagEnd:r,value:e,ovalue:s,nvalue:t,indent:d.length-2+!!d[0].opened}))}f.push({op:C,value:" ",ovalue:t})}}for(;null!==(t=r.exec(e));){switch(a!==t.index&&u(e.substring(a,t.index)),a=r.lastIndex,t[0].charAt(0)){case"<":if(!l()||t[1]&&t[2].toLowerCase()===d[0].tagName){for(;0<=W.indexOf(d[0].tagName)&&o(););t[1]?d[0].tagName!==t[2]||d.length<=(s[0].htmlStackCount||1)?(d[0].muteTagEnd=!0,d[0].opened=void 0):(d[0].opened=!1,u(t[0],!0)):(d.unshift({tagName:t[2].toLowerCase(),text:""}),u(t[0].toLowerCase(),!0),d[0].index=f.length-1)}else u(t[0],!0);continue;case">":case"/":case"-":if(!d[0].tagName||d[0].opened&&"/>"!==t[0]&&"--\x3e"!==t[0])break;d[0].muteTagEnd?d[0].muteTagEnd=!1:u(t[0],!0),(!1===d[0].opened||"/>"===t[0]||"--\x3e"===t[0])&&o()||(d[0].opened=!0);continue;case'"':if(d[0].attrName&&o()){u(t[0],!0);continue}break;default:if(d[0].tagName&&!t[4]){if("!--"!==d[0].tagName&&!d[0].opened){u(" "+t[0],!0),0<=t[0].indexOf("=")&&d.unshift({attrName:t[3],text:""});continue}}else if(d[0].attrName&&'"'===t[0][t[0].length-1]){u(t[0].slice(0,-1)),o(),u('"',!0);continue}}u(t[0])}for(a!==e.length&&u(e.substr(a));d[n];){var i=d.shift().tagName;W.indexOf(i)<0&&u("</"+i+">",!0,"")}}for(n=y(n).replace(/^\r?\n/,""),d.unshift({opened:!0,text:""});null!==(t=i.exec(n));)switch(r!==t.index?(e=n.substring(r,t.index),/^([^\S\r\n]*(\r?\n[^\S\r\n]*))(\S?)/.test(e)&&(e=g.$2.slice(a.length)+e.slice(g.$1.length),g.$3&&f.push({op:C,value:F,ovalue:""})),a=/(\r?\n[^\S\r\n]*)?$/.test(e)&&g.$1||"",l(e)):a="",r=i.lastIndex,t[1]){case"!":break;case"/":c(s[0]&&t[2]===s[0].tokenName),l("",s[0].htmlStackCount),s[0].token.index=f.length,s[0].tokenIf&&!s[0].tokenIf.index&&(s[0].tokenIf.index=f.length),t[2]===L&&f.push({op:m,index:s[0].tokenIndex+1}),s.shift();break;case w:case S:s.unshift({htmlStackCount:d.length,tokenIndex:f.length,tokenName:w,token:{op:b,condition:o(t[2]),negate:t[1]===S}}),f.push(s[0].token);break;case A:case O:case $:c(s[0]&&s[0].tokenName===w),l("",s[0].htmlStackCount);var h=s.splice(0,1,{htmlStackCount:s[0].htmlStackCount,tokenIndex:f.length,tokenName:w,token:{op:M}})[0];(h.tokenIf||h.token).index=f.length+1,h.token.op===M&&(s[0].token=h.token),f.push(s[0].token),t[1]!==O&&t[1]!==$||(s[0].tokenIf={op:b,condition:o(t[2]),negate:t[1]===$},f.push(s[0].tokenIf));break;case L:s.unshift({htmlStackCount:d.length,tokenIndex:f.length,tokenName:L,token:{op:x,expression:o(t[2])}}),f.push(s[0].token);break;default:a="",f.push({op:v,expression:o(t[2]),noescape:"&"===t[1],indent:d.length-1})}l(n.substr(r),1);for(var u=f.length-1,p=0;0<=u;u--)void 0!==f[u].indent?p=f[u].indent:f[u].indent=p;return f.value=n,f}function xe(O,k,e){var n=[],w=k.objStack||[],S=k.iteratorStack||[];function s(e){this.keys=he(e),this.values=e}function c(e){return w[e]instanceof s?w[e].values[w[e].keys[S[e]]]:w[e]}function l(e,n){return Array.isArray(e)?y(A(e)):"object"==typeof e?e.fn(n,e.arg):e}function A(e,n){if(!e||!e[0])return A.valid=!0,c(0);var t,n=A.valid=n||!e.evalMode||1<e[0].length&&"##"!==e[0];switch(e.evalMode){case N:return w[0]instanceof s?w[0].keys[S[0]]:S[0];case E:return S[0];case j:return w[0]instanceof s?w[0].keys.length:0;case p:t=c(e.stackIndex<0?e.stackIndex+w.length:e.stackIndex||0);break;case P:t=k.globals;break;case _:t=+new Date;break;case D:(t=new Date).setHours(0,0,0,0),t=+t;break;case T:t=Math.random();break;default:for(var r=l(e[0],t),a=0,o=w.length;a<o&&!G(t=c(a),r);a++);if(a===w.length&&!(r in(t=k.globals)))return void(A.valid=!1);t=t[r]}for(var u=1,i=e.length;u<i&&d(t);u++)t=t[l(e[u],t)];return A.valid=n,R(t)?void 0:t}function $(a,l,o){l=l||0,o=o||a.length-1;for(var f=[],d=A(),u=l,h=l,i={globals:k.globals,eval:function(e){return A(I(ie,e))},stop:function(){return u=o+1,s},push:function(e){return f.push(e),e},reset:function(){return h=u,i.next()},hasArgs:function(){return u<=o},state:function(){return o<u?"end":a[u].length()?"func":void 0===a[u].canEvaluate?"auto":a[u].canEvaluate?"path":"const"},raw:function(){return u<=o?i.fn()||a[u++].value:void 0},next:function(e){var n=h===u;if(o<u)return n?d:void 0;if(!1===a[u].canEvaluate)return a[u++].value;var t=i.fn();if(t)return t(n?d:s);t=A(a[u].objectPath(),n);return a[u].canEvaluate||A.valid&&(n||e||!Z(s)||Z(t))?(++u,t):n?d:a[u++].value},fn:function(e){var t=u,r=u<=o&&a[u].length();return r?(u+=r+1,function(e,n){try{return w.unshift(arguments.length?e:s),S.unshift(n),$(a,t+1,t+r-1)}finally{w.shift(),S.shift()}}):R(e)?e(i.next()):void 0}},s=i.reset();u<=o;){var p=u,g=a[u++].textValue;try{var e=H[g]||H.__default__(g);if(R(e))if(e.varargs)s=e.call(k.globals,s,i);else switch(e.length){case 1:s=e.call(k.globals,s);break;case 2:s=e.call(k.globals,s,i.next());break;case 3:s=e.call(k.globals,s,i.next(),i.next());break;case 4:s=e.call(k.globals,s,i.next(),i.next(),i.next());break;default:var y=new Array(e.length);y[0]=s;for(var v=1,b=e.length;v<b;v++)y[v]=i.next();s=e.apply(k.globals,y)}else if(Y(e))s=ke(e,s,le({},k,{indentPadding:void 0,trimStart:!0}));else{if(p!==h)throw new Error("Invalid pipe function");s=!1===a[u-1].canEvaluate?a[u-1].value:void 0}}catch(e){return console.warn(e.toString()+" "+ge(O.value,a.index,a.index+a.value.length,a[p].start,a[u-1].end)+(e.stack||"").substr(e.toString().length))}}if(f.length){for(var n=f.concat(s),t=[],r=0,m=n.length;r<m;r++)if(Array.isArray(n[r]))for(var c=0,x=n[r],M=x.length;c<M;c++)void 0!==x[c]&&null!==x[c]&&(t[t.length]=x[c]);else void 0!==n[r]&&null!==n[r]&&(t[t.length]=n[r]);return t}return s}try{var t=k.start||0,o=k.end||O.length,r=!1;for(U.unshift(k);t<o;){var u,a=O[t++];switch(k.level=a.indent,a.op){case v:var i,f=z;d(i=$(a.expression))&&(e=void 0!==e,r&&n.push(r),r=void 0,n.push((z!==f||a.noescape||k.noEncode?B:se)(y(i,ne))));break;case x:w.unshift(new s($(a.expression))),S.unshift(0),w[0].keys.length||(t=a.index);break;case m:++S[0]>=w[0].keys.length?(w.shift(),S.shift()):t=a.index;break;case b:!$(a.condition)^a.negate&&(t=a.index);break;case M:t=a.index;break;case C:k.html?r=!1===r?void 0:a.value===F&&k.indent?(0===(u=F+re(k.indent,a.indent,k.indentPadding)).indexOf(n[n.length-1])&&n.pop(),void n.push(u)):a.value:n.push(a.ovalue);break;default:r&&!a.stripWS&&n.push(r),n.push(!1===k.html?a.nvalue:k.noEncode?a.ovalue:a.value),e=!0,r=!a.stripWSEnd&&void 0}}}finally{z=z+!!e&65535,U.shift()}return k.indent&&k.indentPadding&&!k.trimStart&&n.unshift(k.indentPadding),!0===e?n.join(""):i}function Me(e,n){return{html:!1!==(e=le({},i.defaultOptions,e||{})).html,noEncode:!1===e.html||e.noEncode,indent:d(e.indent)?re(e.indent,1):"",indentPadding:d(e.indentPadding)?re(e.indentPadding,1):U[0]?re(U[0].indent,U[0].level,U[0].indentPadding):"",trimStart:e.trimStart,objStack:[n],globals:(n=i.globals,e=e.globals,t.prototype=n,le(new t,e))};function t(){}}function ke(e,n,t,r){return xe(I(me,e=y(e||"")),Me(t,n),r)}function i(e,n,t){return ke(e,n,t,!0)}ye.prototype=[],ve.prototype.objectPath=function(){return(this.objectPath=X(I(ie,this.textValue.replace(/^\$(?!\()/,"")))).call()},ve.prototype.length=function(){if("["===this.value&&void 0===this.canEvaluate)for(var e=this.next,n=1,t=1;e;e=e.next,n++)if("["===e.value)t++;else if("]"===e.value&&void 0===e.canEvaluate&&0==--t)return(this.length=X(n)).call();this.length=function(){}},i.defaultOptions={},i.globals={},i.string=y,i.eval=function(e,n,t){var r=[{op:v,expression:I(be,e)}];return r.value=e,xe(r,Me(t,n))},i.pipes=le(H,{__default__:X(),keys:he,max:Math.min,min:Math.max,abs:Math.abs,round:Math.round,floor:Math.floor,ceil:Math.ceil,asdate:o,as:function(e,n){return n.globals[y(n.raw())]=e},let:function(e,n){for(;n.hasArgs();)n.globals[y(n.raw())]=n.next()},more:function(e,n){return 0<c(e,n,1)},less:function(e,n){return c(e,n,1)<0},ormore:function(e,n){return 0<=c(e,n,1)},orless:function(e,n){return c(e,n,1)<=0},between:function(e,n,t){n=0<=c(n,t,1)?[t,n]:[n,t];return 0<=c(e,n[0],1)&&c(e,n[1],1)<=0},equals:function(e,n){return y(e)===y(n)},notequals:function(e,n){return y(e)!==y(n)},iequals:e(function(e,n){return e.toLowerCase()===n.toLowerCase()}),inotequals:e(function(e,n){return e.toLowerCase()!==n.toLowerCase()}),startswith:e(function(e,n){return n&&e.substr(0,n.length)===n}),endswith:e(function(e,n){return n&&e.substr(-n.length)===n}),even:function(e){return 0==(1&+e)},odd:function(e){return 1==(1&+e)},contains:function(e,n){return 0<=y(e).indexOf(n)},like:function(e,n){return!1!==(n=I(ue,n))&&n.test(e)},or:function(e,n){return e||n},not:function(e,n){return!(n.hasArgs()?n.next():e)},choose:function(e,n,t){return e?n:t},test:function(e,n){var t=n.next(),r=n.fn(X),n=n.fn(X);return(t?r:n)()},length:function(e){return d(e)&&+e.length||+e||0},concat:function(e,n){return y(e)+y(n)},substr:function(e,n,t){return y(e).substr(n,t)},replace:function(e,n){var t=y(n.next()),r=n.fn()||y(n.next());return y(e).replace(I(ue,t)||t,r.call?function(){var e=K.apply(null,arguments);return e.input=e.pop(),e.index=e.pop(),y(r(e))}:r)},trim:function(e){return y(e).replace(/^\s+|\s+$/g,"")},trimstart:function(e){return y(e).replace(/^\s+/,"")},trimend:function(e){return y(e).replace(/\s+$/,"")},padstart:e(function(e,n){return e.substr(0,n.length)!==n?n+e:e}),padend:e(function(e,n){return e.substr(-n.length)!==n?e+n:e}),removestart:e(function(e,n){return e.substr(0,n.length)===n?e.slice(n.length):e}),removeend:e(function(e,n){return e.substr(-n.length)===n?e.slice(0,-n.length):e}),cutbefore:e(function(e,n){return e.substr(0,(e.indexOf(n)+1||e.length+1)-1)}),cutbeforelast:e(function(e,n){return e.substr(0,(e.lastIndexOf(n)+1||e.length+1)-1)}),cutafter:e(function(e,n){return e.substr(n.length+(e.indexOf(n)+1||1-n.length)-1)}),cutafterlast:e(function(e,n){return e.substr(n.length+(e.lastIndexOf(n)+1||1-n.length)-1)}),split:function(e,n){return fe(y(e).split(n),B)},repeat:function(e,n){return te(n,e)},upper:function(e){return y(e).toUpperCase()},lower:function(e){return y(e).toLowerCase()},ucfirst:function(e){return(e=y(e)).charAt(0).toUpperCase()+e.substr(1)},lcfirst:function(e){return(e=y(e)).charAt(0).toLowerCase()+e.substr(1)},hyphenate:function(e){return I(n,e)},plus:function(e,n){return(+e||0)+(+n||0)},minus:function(e,n){return(+e||0)-(+n||0)},multiply:function(e,n){return(+e||0)*(+n||0)},divide:function(e,n){return(+e||0)/(+n||0)},mod:function(e,n){return(+e||0)%(+n||0)},pow:function(e,n){return Math.pow(+e||0,+n||0)},to:function(e,n){var t=+e,r=+n;if(isNaN(t)||isNaN(r)){var a=/(\d+|\d*\.\d+)/,o=y(e).replace(a,"0"),t=+g.$1,u=g.$1.length;if(y(n).replace(a,"0")!==o)return[e];r=+g.$1}for(var i=[],s=((r=r||0)-(t=t||0))/Math.abs(r-t),c=function(e){e=Math.abs(e).toString();return e.length<u?new Array(u-e.length+1).join("0")+e:e};0<(r-t)/s;t+=s)i.push(o?o.replace("0",c(t)):t);return i.push(o?o.replace("0",c(r)):r),i},join:function(e,n){return[].concat(e).join(y(n))},reverse:function(e){return[].concat(e).reverse()},sort:function(e){return[].concat(e).sort(a[0])},isort:function(e){return[].concat(e).sort(a[1])},rsort:function(e){return[].concat(e).sort(a[2])},irsort:function(e){return[].concat(e).sort(a[3])},slice:function(e,n,t){return[].concat(e).slice(n,t)},unique:function(e){for(var n={},t=[],r=0,a=(e=[].concat(e)).length;r<a;++r)n.hasOwnProperty(e[r])||(n[e[r]]=!0,t.push(e[r]));return t},first:function(e,n){return de(e,ee(n,e))},any:function(e,n){return!!de(e,ee(n,e),!0)},all:function(e,n){return!de(e,ee(n,e),!0,!0)},none:function(e,n){return!de(e,ee(n,e),!0)},where:function(e,n){return fe(e,ee(n,e))},map:function(e,n){return fe(e,X(!0),ee(n,e))},sum:function(e,n){var t,r=n.fn()||(t=n.next(),n.fn()||(n.hasArgs()?ee(n,e):B));return ce(e,function(e,n){t=void 0!==t?t+r(n,e):r(n,e)}),t},sortby:function(e,n){return pe(e,n,a[0])},isortby:function(e,n){return pe(e,n,a[1])},rsortby:function(e,n){return pe(e,n,a[2])},irsortby:function(e,n){return pe(e,n,a[3])},groupby:function(r,e){var a={},o=ee(e,r);return ce(r,function(e,n){var t=y(o(n,e));a.hasOwnProperty(t)||(a[t]=r.push?[]:{}),a[t][r.push?a[t].length:e]=n}),a},addtime:function(e,n){if(!d(e=o(e)))return e;n=I(oe,n);return+new Date(n[0]+e.getFullYear(),n[1]+e.getMonth(),n[2]+e.getDate(),n[3]+e.getHours(),n[4]+e.getMinutes(),n[5]+e.getSeconds(),n[6]+e.getMilliseconds())},in:function(e,n){n=n.next(!0);return Array.isArray(n)?0<=n.indexOf(e):!!n&&"object"==typeof n&&e in n},"??":function(e,n){return null!=e?e:n},"!!":function(e,n){return!!(n.hasArgs()?n.next():e)},"&&":function(e,n){return e?n.reset():n.stop()},"||":function(e,n){return e?n.stop():n.reset()},"|":function(e,n){return n.push(e),n.reset()},":json":JSON.stringify,":query":function(e){return r.buildParams([],e).join("&").replace(/%20/g,"+")},":date":function(e,n){e=e instanceof Date?e:"number"==typeof e?new Date(e):new Date(Date.parse(e));return isNaN(e)?"":r.formatDate(e,n,this.DATE_LABELS)},":printf":function(e,n){return r.sprintf(n,e)}}),"?test !not +plus -minus *multiply /divide %mod ^pow ==equals !=notequals ~=iequals !~=inotequals ^=startswith $=endswith *=contains <less <=orless >more >=ormore ..to ?:choose &concat".replace(/(\W{1,3})(\S+)\s?/g,function(e,n,t){H[n]=H[t]}),ce("where first any all none sum map test not sortby isortby rsortby irsortby groupby replace as let in !! && || |".split(" "),function(e,n){H[n].varargs=!0}),H.__default__=(t=H.__default__,function(n){return"%"===n.charAt(0)?function(e){return r.sprintf(n,e)}:t(n)}),(u=r).buildParams=function(e,n,t){if(t&&Array.isArray(n))for(var r=0,a=n.length;r<a;r++)/\[\]$/.test(t)?e[e.length]=encodeURIComponent(t)+"="+encodeURIComponent(n[r]):u.buildParams(e,n[r],t+"["+("object"==typeof n[r]&&n[r]?r:"")+"]");else if("object"==typeof n)for(var o in n)u.buildParams(e,n[o],t?t+"["+o+"]":o);else e[e.length]=encodeURIComponent(t)+"="+encodeURIComponent(n);return e};var we=r;function Se(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function f(){return f.cache.hasOwnProperty(arguments[0])||(f.cache[arguments[0]]=f.parse(arguments[0])),f.format.call(null,f.cache[arguments[0]],arguments)}function s(e,n){return(e=String(e)).length>=n?e:(new Array(n+1).join("0")+e).substr(-n)}return f.format=function(e,n){for(var t,r,a,o,u,i=1,l=e.length,s=[],c=0;c<l;c++)if("string"===(o=Se(e[c])))s.push(e[c]);else if("array"===o){if((a=e[c])[2])for(t=n[i],r=0;r<a[2].length;r++){if(!t.hasOwnProperty(a[2][r]))throw f('[sprintf] property "%s" does not exist',a[2][r]);t=t[a[2][r]]}else t=a[1]?n[a[1]]:n[i++];if(/[^s]/.test(a[8])&&"number"!=Se(t))throw f("[sprintf] expecting number but found %s",Se(t));switch(a[8]){case"b":t=t.toString(2);break;case"c":t=String.fromCharCode(t);break;case"d":t=parseInt(t,10);break;case"e":t=a[7]?t.toExponential(a[7]):t.toExponential();break;case"f":t=a[7]?parseFloat(t).toFixed(a[7]):parseFloat(t);break;case"o":t=t.toString(8);break;case"s":t=(t=String(t))&&a[7]?t.substring(0,a[7]):t;break;case"u":t>>>=0;break;case"x":t=t.toString(16);break;case"X":t=t.toString(16).toUpperCase()}t=/[def]/.test(a[8])&&a[3]&&0<=t?"+"+t:t,o=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",u=a[6]-String(t).length,o=a[6]?function(e,n){for(var t=[];0<n;t[--n]=e);return t.join("")}(o,u):"",s.push(a[5]?t+o:o+t)}return s.join("")},f.cache={},f.parse=function(e){for(var n=e,t=[],r=[],a=0;n;){if(null!==(t=/^[^\x25]+/.exec(n)))r.push(t[0]);else if(null!==(t=/^\x25{2}/.exec(n)))r.push("%");else{if(null===(t=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(n)))throw"[sprintf] huh?";if(t[2]){a|=1;var o=[],u=t[2],i=[];if(null===(i=/^([a-z_][a-z_\d]*)/i.exec(u)))throw"[sprintf] huh?";for(o.push(i[1]);""!==(u=u.substring(i[0].length));)if(null!==(i=/^\.([a-z_][a-z_\d]*)/i.exec(u)))o.push(i[1]);else{if(null===(i=/^\[(\d+)\]/.exec(u)))throw"[sprintf] huh?";o.push(i[1])}t[2]=o}else a|=2;if(3===a)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(t)}n=n.substring(t[0].length)}return r},we.sprintf=f,we.vsprintf=function(e,n,t){return(t=n.slice(0)).splice(0,0,e),f.apply(null,t)},l={d:"MM/dd/yyyy",D:"dddd, dd MMMM yyyy",f:"dddd, dd MMMM yyyy HH:mm",F:"dddd, dd MMMM yyyy HH:mm:ss",g:"MM/dd/yyyy HH:mm",G:"MM/dd/yyyy HH:mm:ss",m:"MMMM dd",M:"MMMM dd",o:"yyyy\\-MM\\-dd\\THH\\:mm\\:ss\\.fffffffK",O:"yyyy\\-MM\\-dd\\THH\\:mm\\:ss\\.fffffffK",r:"ddd, dd MMM yyyy HH\\:mm\\:ss \\G\\M\\T",R:"ddd, dd MMM yyyy HH\\:mm\\:ss \\G\\M\\T",s:"yyyy\\-MM\\-dd\\THH\\:mm\\:ss",t:"HH:mm",T:"HH:mm:ss",u:"yyyy\\-MM\\-dd HH\\:mm\\:ss\\Z",U:"dddd, dd MMMM yyyy HH:mm:ss",y:"yyyy MMMM",Y:"yyyy MMMM"},h={shortWeekday:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longWeekday:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortMonth:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonth:["January","February","March","April","May","June","July","August","September","October","November","December"],designator:["AM","PM"],era:["B.C.","A.D."],timeSeparator:":",dateSeparator:"/"},r.formatDate=function(r,e,n){e=l[e]||e||"",n=n||{};var t,a={};for(t in h)a[t]=n[t]||h[t];for(var o,u=[],i=/%?(?:(?!\\)(d{1,4}|f{1,7}|F{1,7}|g{1,2}|h{1,2}|H{1,2}|K|m{1,2}|M{1,4}|s{1,2}|t{1,2}|y{1,5}|z{1,3}|\:|\/))|\\?(.)/g;null!==(o=i.exec(e));)u.push(o[1]?function(e){var n=e.length;switch(e.charAt(0)){case"d":return 4===n?a.longWeekday[r.getDay()]:3===n?a.shortWeekday[r.getDay()]:s(r.getDate(),n);case"f":case"F":var t=(r.getMilliseconds()+"000000").substr(0,n);return"f"!==e.charAt(0)&&/^0+$/.test(t)?"":t;case"g":return a.era[+(0<=r.getFullYear())];case"h":return s(r.getHours()%12||12,n);case"H":return s(r.getHours(),n);case"m":return s(r.getMinutes(),n);case"M":return 4===n?a.longMonth[r.getMonth()]:3===n?a.shortMonth[r.getMonth()]:s(r.getMonth()+1,n);case"s":return s(r.getSeconds(),n);case"t":return a.designator[+(12<=r.getHours())].substr(0,n);case"y":return s(3<=n?r.getFullYear():r.getYear(),n);case"K":case"z":t=r.getTimezoneOffset();return 3===n||"K"===e?(0<=t?"-":"+")+s(0|Math.abs(t/60),2)+":"+s(Math.abs(t)%60,2):(0<=t?"-":"+")+s(0|Math.abs(t/60),n);case":":return a.timeSeparator;case"/":return a.dateSeparator}}(o[1]):o[2]);return u.join("")},Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"undefined"!=typeof document&&document.querySelectorAll&&ce(document.querySelectorAll('script[type="text/x-waterpipe"]'),function(e,n){H[n.id]=n.innerHTML}),"object"==typeof module&&(i.with=function(){return i}),i});