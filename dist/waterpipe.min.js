!function(e,n){"function"==typeof define&&define.amd?define("waterpipe",[],n):"object"==typeof module&&module.exports?module.exports=n():e.waterpipe=n()}(this,function(){"use strict";var t,u,p,g,y=1,v=2,b=3,m=4,x=5,M=6,k=7,$=1,C=2,N=3,j=4,P=5,_=6,D=7,T=8,w="if",S="if not",A="else",E="elseif",O="elseif not",L="foreach",F="\r\n",W="area base br col command embed hr img input keygen link meta param source track wbr !doctype !--".split(" "),q={true:!0,false:!1,undefined:void 0,null:null,0:0},R=0,z=[],U="undefined"!=typeof Intl&&Intl.Collator&&new Intl.Collator(void 0,{caseFirst:"upper"}),H=Object.create?Object.create(null):{},r={},a=[function(e,n){return c(e,n,1)},function(e,n){return c(e,n,1,1)},function(e,n){return c(e,n,-1)},function(e,n){return c(e,n,-1,1)}];function I(e,n){var t=e.cache=e.cache||{};return t.hasOwnProperty(n)?t[n]:t[n]=e(n)}function o(e){if(!d(e)||e instanceof Date)return e;if("number"==typeof e)return new Date(e);var n=h(e);return e=new Date(n),/\d{2}:\d{2}:\d{2}/.test(n)||e.setHours(0,0,0,0),e}function J(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n}function K(e){return"function"==typeof e}function Y(e){return"string"==typeof e}function V(e){return"object"==typeof e}function d(e){return null!=e}function Z(e){return"object"!=typeof e||null===e}function G(e,n){return!(!d(e)||K(e[n]))&&(V(e)?e.hasOwnProperty(n)||Array.isArray(e)&&/^\d+$/.test(n):void 0!==e[n])}function B(e){return e}function X(e){return function(){return e}}function Q(n){return function(e){return d(e)?e[n]:void 0}}function i(e,t){function n(n){return fe(t,function(e){return G(e,n)},!0)}switch(e.state()){case"func":return e.fn();case"auto":var r=e.raw(),a=e.eval(r);if(Y(a)&&n(a))return I(Q,a);var o=H[r];return!o||o.varargs||n(r)?I(Q,r):K(o)?o:function(e){return Me(o,e)}}return I(Q,h(e.next()))}function ee(n){try{return JSON.stringify(n)}catch(e){return String(n)}}function h(e,n){return!d(e)||e!=e||K(e)?"":Y(e)?e:(n||String)(e)}function ne(e,n){return new Array((+n||0)+1).join(h(e))}function te(e,n,t){return"number"==typeof e&&(e=ne(" ",e)),(t||"")+ne(e,n)}function re(e,n){return((e||"").length||0)-(+n||0)-1}function ae(e){for(var n,t=1,r=("+"!==e[0]&&"-"!==e[0]||(t="-"===e[0]?-1:1,e=e.slice(1)),[0,0,0,0,0,0,0]),a=/(\d+)([yMwdhms])/g;null!==(n=a.exec(e));)"w"===n[2]?r[2]+=7*parseInt(n[1])*t:r["yMdhms".indexOf(n[2])]+=parseInt(n[1])*t;return r}function oe(e){return"/"===e.charAt(0)&&/\/((?![*+?])(?:[^\r\n\[/\\]|\\.|\[(?:[^\r\n\]\\]|\\.)*\])+)\/((?:g(?:im?|mi?)?|i(?:gm?|mg?)?|m(?:gi?|ig?)?)?)/g.test(e)&&new RegExp(RegExp.$1,RegExp.$2)}function ue(e){for(var n,t=[],r=/((?!^)\$)?([^$.()][^.]*)|\$\(([^)]+)\)/gi;null!==(n=r.exec(e));)t.push(n[1]||n[3]?I(ue,n[3]||n[2]):"^"===n[2][0]?{fn:re,arg:n[2].slice(1)}:n[2]);switch(t.length||(t[0]=e),t[0]){case".":case"@0":t.evalMode=$;break;case"#":case"#key":t.evalMode=C;break;case"##":case"#index":t.evalMode=N;break;case"#count":t.evalMode=j;break;case"_":case"@root":t.evalMode=$,t.stackIndex=-1;break;case"@global":t.evalMode=P;break;case"@now":t.evalMode=_;break;case"@today":t.evalMode=D;break;case"@random":t.evalMode=T;break;default:/^@(\d+)$/.test(t[0])&&(t.evalMode=$,t.stackIndex=+RegExp.$1)}return t}function ie(e,n){n=n?/["'<>]|&(?!#\d+;|[a-z][a-z0-9]+;)/i:/["'&<>]/;if(!n.exec(e))return e;for(var t,r="",a=0,o=0,a=n.lastIndex;a<e.length;a++){switch(e.charCodeAt(a)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}o!==a&&(r+=e.substring(o,a)),o=a+1,r+=t}return o!==a?r+e.substring(o,a):r}function n(e){return h(e).replace(/[A-Z](?:[A-Z]+(?=$|[A-Z]))?/g,function(e,n){return(0<n?"-":"")+e.toLowerCase()})}function se(e,n){if(e&&"length"in e){for(r=0,a=e.length;r<a;r++)if(!1===n(r,e[r]))return}else if(e&&V(e))for(var t=Object.getOwnPropertyNames(e),r=0,a=t.length;r<a;r++)if(!1===n(t[r],e[t[r]]))return}function ce(){for(var e=J.apply(null,arguments),n=1,t=e.length;n<t;n++)for(var r in e[n])e[0][r]=e[n][r];return e[0]}function le(t,r,a){if(!d(t))return t;var o=Array.isArray(t)?[]:{};return se(t,function(e,n){r(n,e)&&(o[t.push?o.length:e]=(a||B)(n,e))}),o}function fe(e,t,r,a){var o;return se(e,function(e,n){if(a^!!t(n,e))return o=r||n,!1}),o}function de(e){var n=[];return se(e,function(e){n.push(e)}),n}function c(e,n,t,r){if(Array.isArray(e)&&Array.isArray(n)){for(var a,o=0,u=Math.min(e.length,n.length);o<u&&!a;o++)a=c(e[o],n[o],t,r);return a||e.length-n.length}if(e===n)return 0;var i=!d(e)&&-1,s=!d(n)&&1;if(i||s)return(i+s)*t;if(Y(e)||Y(n)){if(e=h(e),n=h(n),r){if(U)return U.compare(e,n)*t;e=e.toLowerCase(),n=n.toLowerCase()}return(n<e?1:e<n?-1:0)*t}return(e-n)*t}function he(t,e,r){if(!d(t))return t;var a=Array.isArray(t)?new Array(t.length):{},o=i(e,t),u=[];return se(t,function(e,n){u.push([e,n,o(n,e)])}),u.sort(function(e,n){return r(e[2],n[2])}),se(u,function(e,n){a[t.push?e:n[0]]=n[1]}),a}function pe(e,n,t,r,a){var o=e.substr(0,r||n).split("\n").reverse(),u=e.substring(e.lastIndexOf("\n",n)+1,n).replace(/^\s+/,"").substr(-20),e=e.substring(n,e.indexOf("\n",t)+1||e.length).replace(/\r?\n|\s+$/g,"").substr(0,t-n+20);return s("at line {{$0}} column {{$1}}:{{$6}}{{&$2}}{{&$3}}{{$6}}{{$2.length + $4 repeat \\ }}{{$5 repeat ^}}",[o.length,o[0].length+1,u,e,r-n||0,a-r||t-n,"\n\t"])}function e(t){return function(e,n){return t(h(e),h(n))}}function ge(e,n){this.value=e,this.index=n}function ye(e,n,t,r,a){var o=this;o.textValue=n,o.value=(n=n,q.hasOwnProperty(n)?q[n]:/^(NaN|-?(?:(?:\d+|\d*\.\d+)(?:[E|e][+|-]?\d+)?|Infinity))$/.test(n)?parseFloat(n):n),o.canEvaluate=o.value===o.textValue&&a,o.start=t,o.end=r,e&&(e.next=o)}function ve(e,n){for(var t,r=new ge(e,n||0),a=/([^\s\\"`]|\\.)(?:[^\s\\]|\\.)*|"((?:[^"\\]|\\.)*)"|`(\S+)/gi;null!==(t=a.exec(e));)r.unshift(new ye(r[0],(t[3]||(void 0!==t[2]?t[2]:t[0])).replace(/\\(.)/g,"$1"),r.index+t.index,r.index+a.lastIndex,!t[3]&&void 0===t[2]&&("$"===t[1]||void 0)));return r.reverse()}function be(n){var t,l=[],f=[{}],d=[],e=0,i=/\{\{([\/!]|foreach(?=\s|\})|if(?:\snot)?(?=\s)|else(?:if(?:\snot)?(?=\s))?|&?(?!\}))\s*((?:\}(?!\})|[^}])*\}*)\}\}/g;function s(e){if(!e)throw new Error("Unexpected "+t[0]+" "+pe(n,t.index,i.lastIndex))}function r(e){return ve(e,t.index+t[0].indexOf(e))}function a(e,n){var t,u=l.length,r=/<(\/?)([0-9a-z]+|!doctype|!--)|\/?>|-->|([^\s=\/<>"0-9.-][^\s=\/<>"]*)(?:="|$|(?=[\s=\/<>"]))|"|\r?\n\s*/gi,a=0;function i(){return"script"===d[0].tagName||"style"===d[0].tagName||"!--"===d[0].tagName}function o(){return d.length>(f[0].htmlStackCount||1)&&d.shift()}function s(e,n){var t,r,a,o;i()?l.push({op:k,value:e}):(n||d[0].attrName||d[0].opened)&&(o=l[l.length-1],t=l[l.length-2],r=e,n||(a=0<=e.indexOf("\n"),r=e=e.replace(/\s+/g,d[0].opened||d[0].attrName&&d[0].text?" ":""),a&=!(e=ie(e,!0))||" "===e),d[0].text+=e,a?(o.stripWSEnd=!1,l.push({op:M,value:F})):e&&(d[1]&&d[0].opened||" "!==e)?(a=">"===e[e.length-1],l.length>u&&o.op===k?(o.value+=e,o.ovalue+=r,o.isTagEnd=a,o.stripWSEnd=n):l.length>u+1&&t.op===k&&o.value!==F?(o="<"===e[0]||t.isTagEnd||!n&&!t.stripWSEnd?o.value:"",t.value+=o+e,t.ovalue+=o+r,t.isTagEnd=a,t.stripWSEnd=n,l.pop()):l.push({op:k,stripWS:n,stripWSEnd:n,isTagEnd:a,value:e,ovalue:r,indent:d.length-2+!!d[0].opened})):l.push({op:M,value:" "}))}for(;null!==(t=r.exec(e));){switch(a!==t.index&&s(e.substring(a,t.index)),a=r.lastIndex,t[0].charAt(0)){case"<":if(!i()||t[1]&&t[2].toLowerCase()===d[0].tagName){for(;0<=W.indexOf(d[0].tagName)&&o(););t[1]?d[0].tagName!==t[2]||d.length<=(f[0].htmlStackCount||1)?(d[0].muteTagEnd=!0,d[0].opened=void 0):(d[0].opened=!1,s(t[0],!0)):(d.unshift({tagName:t[2].toLowerCase(),text:""}),s(t[0].toLowerCase(),!0),d[0].index=l.length-1)}else s(t[0],!0);continue;case">":case"/":case"-":if(!d[0].tagName||d[0].opened&&"/>"!==t[0]&&"--\x3e"!==t[0])break;d[0].muteTagEnd?d[0].muteTagEnd=!1:s(t[0],!0),(!1===d[0].opened||"/>"===t[0]||"--\x3e"===t[0])&&o()||(d[0].opened=!0);continue;case'"':if(d[0].attrName&&o()){s(t[0],!0);continue}break;default:if(d[0].tagName&&"!--"!==d[0].tagName&&!d[0].opened){s(" "+t[0],!0),0<=t[0].indexOf("=")&&d.unshift({attrName:t[3],text:""});continue}}s(t[0])}for(a!==e.length&&s(e.substr(a));d[n];){var c=d.shift().tagName;W.indexOf(c)<0&&s("</"+c+">",!0)}}for(n=h(n).replace(/^\s+|\s+$/g,""),d.unshift({opened:!0,text:""});null!==(t=i.exec(n));)switch(e!==t.index&&a(n.substring(e,t.index)),e=i.lastIndex,t[1]){case"!":break;case"/":s(f[0]&&t[2]===f[0].tokenName),a("",f[0].htmlStackCount),f[0].token.index=l.length,f[0].tokenIf&&!f[0].tokenIf.index&&(f[0].tokenIf.index=l.length),t[2]===L&&l.push({op:b,index:f[0].tokenIndex+1}),f.shift();break;case w:case S:f.unshift({htmlStackCount:d.length,tokenIndex:l.length,tokenName:w,token:{op:v,condition:r(t[2]),negate:t[1]===S}}),l.push(f[0].token);break;case A:case E:case O:s(f[0]&&f[0].tokenName===w),a("",f[0].htmlStackCount);var o=f.splice(0,1,{htmlStackCount:f[0].htmlStackCount,tokenIndex:l.length,tokenName:w,token:{op:x}})[0];(o.tokenIf||o.token).index=l.length+1,o.token.op===x&&(f[0].token=o.token),l.push(f[0].token),t[1]!==E&&t[1]!==O||(f[0].tokenIf={op:v,condition:r(t[2]),negate:t[1]===O},l.push(f[0].tokenIf));break;case L:f.unshift({htmlStackCount:d.length,tokenIndex:l.length,tokenName:L,token:{op:m,expression:r(t[2])}}),l.push(f[0].token);break;default:l.push({op:y,expression:r(t[2]),noescape:"&"===t[1],indent:d.length-1})}a(n.substr(e),1);for(var u=l.length-1,c=0;0<=u;u--)void 0!==l[u].indent?c=l[u].indent:l[u].indent=c;return l.value=n,l}function me(E,k,e){var n=[],w=k.objStack||[],S=k.iteratorStack||[];function s(e){this.keys=de(e),this.values=e}function c(e){return w[e]instanceof s?w[e].values[w[e].keys[S[e]]]:w[e]}function l(e,n){return Array.isArray(e)?h(A(e)):"object"==typeof e?e.fn(n,e.arg):e}function A(e,n){if(!e||!e[0])return A.valid=!0,c(0);var t,n=A.valid=n||!e.evalMode||1<e[0].length&&"##"!==e[0];switch(e.evalMode){case C:return w[0]instanceof s?w[0].keys[S[0]]:S[0];case N:return S[0];case j:return w[0]instanceof s?w[0].keys.length:0;case $:t=c(e.stackIndex<0?e.stackIndex+w.length:e.stackIndex||0);break;case P:t=k.globals;break;case _:t=+new Date;break;case D:(t=new Date).setHours(0,0,0,0),t=+t;break;case T:t=Math.random();break;default:for(var r=l(e[0],t),a=0,o=w.length;a<o&&!G(t=c(a),r);a++);if(a===w.length&&!(r in(t=k.globals)))return void(A.valid=!1);t=t[r]}for(var u=1,i=e.length;u<i&&d(t);u++)t=t[l(e[u],t)];return A.valid=n,K(t)?void 0:t}function O(a,l,o){l=l||0,o=o||a.length-1;for(var f=[],d=A(),u=l,h=l,i={globals:k.globals,eval:function(e){return A(I(ue,e))},stop:function(){return u=o+1,s},push:function(e){return f.push(e),e},reset:function(){return h=u,i.next()},hasArgs:function(){return u<=o},state:function(){return o<u?"end":a[u].length()?"func":void 0===a[u].canEvaluate?"auto":a[u].canEvaluate?"path":"const"},raw:function(){return u<=o?i.fn()||a[u++].value:void 0},next:function(e){var n=h===u;if(o<u)return n?d:void 0;if(!1===a[u].canEvaluate)return a[u++].value;var t=i.fn();if(t)return t(n?d:s);t=A(a[u].objectPath(),n);return a[u].canEvaluate||A.valid&&(n||e||!Z(s)||Z(t))?(++u,t):n?d:a[u++].value},fn:function(e){var t=u,r=u<=o&&a[u].length();return r?(u+=r+1,function(e,n){try{return w.unshift(arguments.length?e:s),S.unshift(n),O(a,t+1,t+r-1)}finally{w.shift(),S.shift()}}):K(e)?e(i.next()):void 0}},s=i.reset();u<=o;){var p=u,g=a[u++].textValue;try{var e=H[g]||H.__default__(g);if(K(e))if(e.varargs)s=e.call(k.globals,s,i);else switch(e.length){case 1:s=e.call(k.globals,s);break;case 2:s=e.call(k.globals,s,i.next());break;case 3:s=e.call(k.globals,s,i.next(),i.next());break;case 4:s=e.call(k.globals,s,i.next(),i.next(),i.next());break;default:var y=new Array(e.length);y[0]=s;for(var v=1,b=e.length;v<b;v++)y[v]=i.next();s=e.apply(k.globals,y)}else if(Y(e))s=Me(e,s,ce({},k,{indentPadding:void 0,trimStart:!0}));else{if(p!==h)throw new Error("Invalid pipe function");s=!1===a[u-1].canEvaluate?a[u-1].value:void 0}}catch(e){return console.warn(e.toString()+" "+pe(E.value,a.index,a.index+a.value.length,a[p].start,a[u-1].end)+(e.stack||"").substr(e.toString().length))}}if(f.length){for(var n=f.concat(s),t=[],r=0,m=n.length;r<m;r++)if(Array.isArray(n[r]))for(var c=0,x=n[r],M=x.length;c<M;c++)void 0!==x[c]&&null!==x[c]&&(t[t.length]=x[c]);else void 0!==n[r]&&null!==n[r]&&(t[t.length]=n[r]);return t}return s}try{var t=k.start||0,o=k.end||E.length,r=!1;for(z.unshift(k);t<o;){var a=E[t++];switch(k.level=a.indent,a.op){case y:var u,i=R;d(u=O(a.expression))&&(e=void 0!==e,r&&n.push(r),r=void 0,n.push((R!==i||a.noescape||k.noEncode?B:ie)(h(u,ee))));break;case m:w.unshift(new s(O(a.expression))),S.unshift(0),w[0].keys.length||(t=a.index);break;case b:++S[0]>=w[0].keys.length?(w.shift(),S.shift()):t=a.index;break;case v:!O(a.condition)^a.negate&&(t=a.index);break;case x:t=a.index;break;case M:var f,r=!1===r?void 0:a.value===F&&k.indent?(0===(f=F+te(k.indent,a.indent,k.indentPadding)).indexOf(n[n.length-1])&&n.pop(),void n.push(f)):a.value;break;default:r&&!a.stripWS&&n.push(r),n.push(k.noEncode?a.ovalue:a.value),e=!0,r=!a.stripWSEnd&&void 0}}}finally{R=R+!!e&65535,z.shift()}return k.indent&&k.indentPadding&&!k.trimStart&&n.unshift(k.indentPadding),!0===e?n.join(""):u}function xe(e,n){return{noEncode:(e=ce({},s.defaultOptions,e||{})).noEncode,indent:d(e.indent)?te(e.indent,1):"",indentPadding:d(e.indentPadding)?te(e.indentPadding,1):z[0]?te(z[0].indent,z[0].level,z[0].indentPadding):"",trimStart:e.trimStart,objStack:[n],globals:(n=s.globals,e=e.globals,t.prototype=n,ce(new t,e))};function t(){}}function Me(e,n,t,r){return me(I(be,e=h(e||"")),xe(t,n),r)}function s(e,n,t){return Me(e,n,t,!0)}ge.prototype=[],ye.prototype.objectPath=function(){return(this.objectPath=X(I(ue,this.textValue.replace(/^\$(?!\()/,"")))).call()},ye.prototype.length=function(){if("["===this.value&&void 0===this.canEvaluate)for(var e=this.next,n=1,t=1;e;e=e.next,n++)if("["===e.value)t++;else if("]"===e.value&&0==--t)return(this.length=X(n)).call();this.length=function(){}},s.defaultOptions={},s.globals={},s.string=h,s.eval=function(e,n,t){var r=[{op:y,expression:I(ve,e)}];return r.value=e,me(r,xe(t,n))},s.pipes=ce(H,{__default__:X(),keys:de,max:Math.min,min:Math.max,abs:Math.abs,round:Math.round,floor:Math.floor,ceil:Math.ceil,asdate:o,as:function(e,n){return n.globals[h(n.raw())]=e},let:function(e,n){for(;n.hasArgs();)n.globals[h(n.raw())]=n.next()},more:function(e,n){return 0<c(e,n,1)},less:function(e,n){return c(e,n,1)<0},ormore:function(e,n){return 0<=c(e,n,1)},orless:function(e,n){return c(e,n,1)<=0},between:function(e,n,t){n=0<=c(n,t,1)?[t,n]:[n,t];return 0<=c(e,n[0],1)&&c(e,n[1],1)<=0},equals:function(e,n){return h(e)===h(n)},notequals:function(e,n){return h(e)!==h(n)},iequals:e(function(e,n){return e.toLowerCase()===n.toLowerCase()}),inotequals:e(function(e,n){return e.toLowerCase()!==n.toLowerCase()}),startswith:e(function(e,n){return n&&e.substr(0,n.length)===n}),endswith:e(function(e,n){return n&&e.substr(-n.length)===n}),even:function(e){return 0==(1&+e)},odd:function(e){return 1==(1&+e)},contains:function(e,n){return 0<=h(e).indexOf(n)},like:function(e,n){return!1!==(n=I(oe,n))&&n.test(e)},or:function(e,n){return e||n},not:function(e,n){return!(n.hasArgs()?n.next():e)},choose:function(e,n,t){return e?n:t},test:function(e,n){var t=n.next(),r=n.fn(X),n=n.fn(X);return(t?r:n)()},length:function(e){return d(e)&&+e.length||+e||0},concat:function(e,n){return h(e)+h(n)},substr:function(e,n,t){return h(e).substr(n,t)},replace:function(e,n){var t=h(n.next()),r=n.fn()||h(n.next());return h(e).replace(I(oe,t)||t,r.call?function(){var e=J.apply(null,arguments);return e.input=e.pop(),e.index=e.pop(),h(r(e))}:r)},trim:function(e){return h(e).replace(/^\s+|\s+$/g,"")},trimstart:function(e){return h(e).replace(/^\s+/,"")},trimend:function(e){return h(e).replace(/\s+$/,"")},padstart:e(function(e,n){return e.substr(0,n.length)!==n?n+e:e}),padend:e(function(e,n){return e.substr(-n.length)!==n?e+n:e}),removestart:e(function(e,n){return e.substr(0,n.length)===n?e.slice(n.length):e}),removeend:e(function(e,n){return e.substr(-n.length)===n?e.slice(0,-n.length):e}),cutbefore:e(function(e,n){return e.substr(0,(e.indexOf(n)+1||e.length+1)-1)}),cutbeforelast:e(function(e,n){return e.substr(0,(e.lastIndexOf(n)+1||e.length+1)-1)}),cutafter:e(function(e,n){return e.substr(n.length+(e.indexOf(n)+1||1-n.length)-1)}),cutafterlast:e(function(e,n){return e.substr(n.length+(e.lastIndexOf(n)+1||1-n.length)-1)}),split:function(e,n){return le(h(e).split(n),B)},repeat:function(e,n){return ne(n,e)},upper:function(e){return h(e).toUpperCase()},lower:function(e){return h(e).toLowerCase()},ucfirst:function(e){return(e=h(e)).charAt(0).toUpperCase()+e.substr(1)},lcfirst:function(e){return(e=h(e)).charAt(0).toLowerCase()+e.substr(1)},hyphenate:function(e){return I(n,e)},plus:function(e,n){return(+e||0)+(+n||0)},minus:function(e,n){return(+e||0)-(+n||0)},multiply:function(e,n){return(+e||0)*(+n||0)},divide:function(e,n){return(+e||0)/(+n||0)},mod:function(e,n){return(+e||0)%(+n||0)},pow:function(e,n){return Math.pow(+e||0,+n||0)},to:function(e,n){var t=+e,r=+n;if(isNaN(t)||isNaN(r)){var a=/(\d+|\d*\.\d+)/,o=h(e).replace(a,"0"),t=+RegExp.$1,u=RegExp.$1.length;if(h(n).replace(a,"0")!==o)return[e];r=+RegExp.$1}for(var i=[],s=((r=r||0)-(t=t||0))/Math.abs(r-t),c=function(e){e=Math.abs(e).toString();return e.length<u?new Array(u-e.length+1).join("0")+e:e};0<(r-t)/s;t+=s)i.push(o?o.replace("0",c(t)):t);return i.push(o?o.replace("0",c(r)):r),i},join:function(e,n){return[].concat(e).join(h(n))},reverse:function(e){return[].concat(e).reverse()},sort:function(e){return[].concat(e).sort(a[0])},isort:function(e){return[].concat(e).sort(a[1])},rsort:function(e){return[].concat(e).sort(a[2])},irsort:function(e){return[].concat(e).sort(a[3])},slice:function(e,n,t){return[].concat(e).slice(n,t)},unique:function(e){for(var n={},t=[],r=0,a=(e=[].concat(e)).length;r<a;++r)n.hasOwnProperty(e[r])||(n[e[r]]=!0,t.push(e[r]));return t},first:function(e,n){return fe(e,i(n,e))},any:function(e,n){return!!fe(e,i(n,e),!0)},all:function(e,n){return!fe(e,i(n,e),!0,!0)},none:function(e,n){return!fe(e,i(n,e),!0)},where:function(e,n){return le(e,i(n,e))},map:function(e,n){return le(e,X(!0),i(n,e))},sum:function(e,n){var t,r=n.fn()||(t=n.next(),n.fn()||(n.hasArgs()?i(n,e):B));return se(e,function(e,n){t=void 0!==t?t+r(n,e):r(n,e)}),t},sortby:function(e,n){return he(e,n,a[0])},isortby:function(e,n){return he(e,n,a[1])},rsortby:function(e,n){return he(e,n,a[2])},irsortby:function(e,n){return he(e,n,a[3])},groupby:function(r,e){var a={},o=i(e,r);return se(r,function(e,n){var t=h(o(n,e));a.hasOwnProperty(t)||(a[t]=r.push?[]:{}),a[t][r.push?a[t].length:e]=n}),a},addtime:function(e,n){if(!d(e=o(e)))return e;n=I(ae,n);return+new Date(n[0]+e.getFullYear(),n[1]+e.getMonth(),n[2]+e.getDate(),n[3]+e.getHours(),n[4]+e.getMinutes(),n[5]+e.getSeconds(),n[6]+e.getMilliseconds())},in:function(e,n){n=n.next(!0);return Array.isArray(n)?0<=n.indexOf(e):!!n&&"object"==typeof n&&e in n},"??":function(e,n){return null!=e?e:n},"!!":function(e,n){return!!(n.hasArgs()?n.next():e)},"&&":function(e,n){return e?n.reset():n.stop()},"||":function(e,n){return e?n.stop():n.reset()},"|":function(e,n){return n.push(e),n.reset()},":json":JSON.stringify,":query":function(e){return r.buildParams([],e).join("&").replace(/%20/g,"+")},":date":function(e,n){e=e instanceof Date?e:"number"==typeof e?new Date(e):new Date(Date.parse(e));return isNaN(e)?"":r.formatDate(e,n,this.DATE_LABELS)},":printf":function(e,n){return r.sprintf(n,e)}}),"?test !not +plus -minus *multiply /divide %mod ^pow ==equals !=notequals ~=iequals !~=inotequals ^=startswith $=endswith *=contains <less <=orless >more >=ormore ..to ?:choose &concat".replace(/(\W{1,3})(\S+)\s?/g,function(e,n,t){H[n]=H[t]}),se("where first any all none sum map test not sortby isortby rsortby irsortby groupby replace as let in !! && || |".split(" "),function(e,n){H[n].varargs=!0}),H.__default__=(t=H.__default__,function(n){return"%"===n.charAt(0)?function(e){return r.sprintf(n,e)}:t(n)}),(u=r).buildParams=function(e,n,t){if(t&&Array.isArray(n))for(var r=0,a=n.length;r<a;r++)/\[\]$/.test(t)?e[e.length]=encodeURIComponent(t)+"="+encodeURIComponent(n[r]):u.buildParams(e,n[r],t+"["+("object"==typeof n[r]&&n[r]?r:"")+"]");else if("object"==typeof n)for(var o in n)u.buildParams(e,n[o],t?t+"["+o+"]":o);else e[e.length]=encodeURIComponent(t)+"="+encodeURIComponent(n);return e};var ke=r;function we(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function f(){return f.cache.hasOwnProperty(arguments[0])||(f.cache[arguments[0]]=f.parse(arguments[0])),f.format.call(null,f.cache[arguments[0]],arguments)}function l(e,n){return(e=String(e)).length>=n?e:(new Array(n+1).join("0")+e).substr(-n)}return f.format=function(e,n){for(var t,r,a,o,u,i=1,l=e.length,s=[],c=0;c<l;c++)if("string"===(o=we(e[c])))s.push(e[c]);else if("array"===o){if((a=e[c])[2])for(t=n[i],r=0;r<a[2].length;r++){if(!t.hasOwnProperty(a[2][r]))throw f('[sprintf] property "%s" does not exist',a[2][r]);t=t[a[2][r]]}else t=a[1]?n[a[1]]:n[i++];if(/[^s]/.test(a[8])&&"number"!=we(t))throw f("[sprintf] expecting number but found %s",we(t));switch(a[8]){case"b":t=t.toString(2);break;case"c":t=String.fromCharCode(t);break;case"d":t=parseInt(t,10);break;case"e":t=a[7]?t.toExponential(a[7]):t.toExponential();break;case"f":t=a[7]?parseFloat(t).toFixed(a[7]):parseFloat(t);break;case"o":t=t.toString(8);break;case"s":t=(t=String(t))&&a[7]?t.substring(0,a[7]):t;break;case"u":t>>>=0;break;case"x":t=t.toString(16);break;case"X":t=t.toString(16).toUpperCase()}t=/[def]/.test(a[8])&&a[3]&&0<=t?"+"+t:t,o=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",u=a[6]-String(t).length,o=a[6]?function(e,n){for(var t=[];0<n;t[--n]=e);return t.join("")}(o,u):"",s.push(a[5]?t+o:o+t)}return s.join("")},f.cache={},f.parse=function(e){for(var n=e,t=[],r=[],a=0;n;){if(null!==(t=/^[^\x25]+/.exec(n)))r.push(t[0]);else if(null!==(t=/^\x25{2}/.exec(n)))r.push("%");else{if(null===(t=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(n)))throw"[sprintf] huh?";if(t[2]){a|=1;var o=[],u=t[2],i=[];if(null===(i=/^([a-z_][a-z_\d]*)/i.exec(u)))throw"[sprintf] huh?";for(o.push(i[1]);""!==(u=u.substring(i[0].length));)if(null!==(i=/^\.([a-z_][a-z_\d]*)/i.exec(u)))o.push(i[1]);else{if(null===(i=/^\[(\d+)\]/.exec(u)))throw"[sprintf] huh?";o.push(i[1])}t[2]=o}else a|=2;if(3===a)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(t)}n=n.substring(t[0].length)}return r},ke.sprintf=f,ke.vsprintf=function(e,n,t){return(t=n.slice(0)).splice(0,0,e),f.apply(null,t)},p={d:"MM/dd/yyyy",D:"dddd, dd MMMM yyyy",f:"dddd, dd MMMM yyyy HH:mm",F:"dddd, dd MMMM yyyy HH:mm:ss",g:"MM/dd/yyyy HH:mm",G:"MM/dd/yyyy HH:mm:ss",m:"MMMM dd",M:"MMMM dd",o:"yyyy\\-MM\\-dd\\THH\\:mm\\:ss\\.fffffffK",O:"yyyy\\-MM\\-dd\\THH\\:mm\\:ss\\.fffffffK",r:"ddd, dd MMM yyyy HH\\:mm\\:ss \\G\\M\\T",R:"ddd, dd MMM yyyy HH\\:mm\\:ss \\G\\M\\T",s:"yyyy\\-MM\\-dd\\THH\\:mm\\:ss",t:"HH:mm",T:"HH:mm:ss",u:"yyyy\\-MM\\-dd HH\\:mm\\:ss\\Z",U:"dddd, dd MMMM yyyy HH:mm:ss",y:"yyyy MMMM",Y:"yyyy MMMM"},g={shortWeekday:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longWeekday:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortMonth:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonth:["January","February","March","April","May","June","July","August","September","October","November","December"],designator:["AM","PM"],era:["B.C.","A.D."],timeSeparator:":",dateSeparator:"/"},r.formatDate=function(r,e,n){e=p[e]||e||"",n=n||{};var t,a={};for(t in g)a[t]=n[t]||g[t];for(var o,u=[],i=/%?(?:(?!\\)(d{1,4}|f{1,7}|F{1,7}|g{1,2}|h{1,2}|H{1,2}|K|m{1,2}|M{1,4}|s{1,2}|t{1,2}|y{1,5}|z{1,3}|\:|\/))|\\?(.)/g;null!==(o=i.exec(e));)u.push(o[1]?function(e){var n=e.length;switch(e.charAt(0)){case"d":return 4===n?a.longWeekday[r.getDay()]:3===n?a.shortWeekday[r.getDay()]:l(r.getDate(),n);case"f":case"F":var t=(r.getMilliseconds()+"000000").substr(0,n);return"f"!==e.charAt(0)&&/^0+$/.test(t)?"":t;case"g":return a.era[+(0<=r.getFullYear())];case"h":return l(r.getHours()%12||12,n);case"H":return l(r.getHours(),n);case"m":return l(r.getMinutes(),n);case"M":return 4===n?a.longMonth[r.getMonth()]:3===n?a.shortMonth[r.getMonth()]:l(r.getMonth()+1,n);case"s":return l(r.getSeconds(),n);case"t":return a.designator[+(12<=r.getHours())].substr(0,n);case"y":return l(3<=n?r.getFullYear():r.getYear(),n);case"K":case"z":t=r.getTimezoneOffset();return 3===n||"K"===e?(0<=t?"-":"+")+l(0|Math.abs(t/60),2)+":"+l(Math.abs(t)%60,2):(0<=t?"-":"+")+l(0|Math.abs(t/60),n);case":":return a.timeSeparator;case"/":return a.dateSeparator}}(o[1]):o[2]);return u.join("")},Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"undefined"!=typeof document&&document.querySelectorAll&&se(document.querySelectorAll('script[type="text/x-waterpipe"]'),function(e,n){H[n.id]=n.innerHTML}),"object"==typeof module&&(s.with=function(){return s}),s});